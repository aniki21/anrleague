<p><%= page_entries_info(@games,model:"game") %></p>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Corporation</th>
        <th>Runner</th>
        <th style="width:120px;"><!-- actions --></th>
      </tr>
    </thead>
    <tbody>
    <% games.each do |game| %>
      <tr<% if game.has_player?(current_user.id) %> class="<%= result_row(game.result_for_player(current_user.id)) %>"<% end %>>
        <td>
          <div class="pull-left" style="padding-right:10px;">
            <%= gravatar(game.corp_player.email,40) %>
          </div>
          <%= link_to game.corp_player.display_name, profile_path(game.corp_player.id, game.corp_player.slug) %>
          <% unless game.corp_identity_id.blank? %><br /><small><%= player_identity(game.corp_identity,"Corp") %></small><% end %>
        </td>
        <td>
          <div class="pull-left" style="padding-right:10px;">
            <%= gravatar(game.runner_player.email,40) %>
          </div>
          <%= link_to game.runner_player.display_name, profile_path(game.runner_player.id, game.runner_player.slug) %>
          <% unless game.runner_identity_id.blank? %><br /><small><%= player_identity(game.runner_identity,"Runner") %></small><% end %>
        </td>
        <td>
          <% if game.unplayed? %>
            <% if game.has_player?(current_user.id) %>
            <%= link_to 'Update'.html_safe, "javascript:void(0);", class:"btn btn-default btn-xs", "data-action":"gameResult", "data-game-id":game.id, "data-season-id":game.season_id, "data-league-id":game.league_id %>
            <%# <%= link_to 'Submit result'.html_safe, edit_league_season_game_path(game.league_id,game.season_id,game.id), class:"btn btn-default btn-xs" %1> %>
            <% else %>
              <em>Upcoming</em>
            <% end %>
          <% else %>
            <% if game.has_player?(current_user.id) %>
              <%= game.result_for_player(current_user.id) %>
            <% else %>
              <%= game.result.display_name %>
            <% end %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- game modal -->
<div class="modal fade" id="gameResultModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-times"></i></span></button>
        Update game result
      </div>
      <div class="modal-body">
        <iframe id="gameResultIframe" style="width:100%; height:300px; border:0;" src="/blank"></iframe>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$('[data-action="gameResult"]').on('click',function(e){
  var t = $(this);
  e.preventDefault();
  var iframe_url = "/leagues/"+t.attr('data-league-id')+"/seasons/"+t.attr('data-season-id')+"/games/"+t.attr('data-game-id')+"/edit";
  $('#gameResultModal').modal('show');
  $('#gameResultIframe').attr("src",iframe_url);
});

var closeGameResultModal = function(){
  $('#gameResultModal').modal('hide');  
  location.reload();
};
</script>
