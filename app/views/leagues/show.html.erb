<h1>
  <%= @league.display_name %>
  <%= league_member(@league) %>  
  <small><% if @league.offline? %><%= @league.offline_location %><% elsif @league.online? %><%= link_to "Online", @league.online_location, target:"_blank" %><% else %>No location specified<% end %></small>
</h1>

<% if @officer %>
  <p><%= link_to "Manage", edit_league_path(@league.id), class:"btn btn-default btn-sm" %></p> 
<% end %>

<% unless @member %>
  <% unless @league.invitational? %>
    <p><%= form_tag league_join_index_path(@league.id) do %><%= submit_tag "Join this league", class: "btn btn-success" %><% end %></p>
  <% else %>
    <p>This league is invitation-only</p>
  <% end %>
<% end %>


<div class="row">
  <div class="col-md-8">

    <%= render partial: "seasons/league_table", locals: { season: @season } if !@season.blank? && ( @league.table_privacy == "public" || @member ) %>

    <% if logged_in? && current_user.member_of?(@league) %>
      <h3>My Games</h3>
      <% unless @season.blank? %>
        <% if @games.any? %>
          <%= render partial: "seasons/user_games", locals: { games: @games } %>
          <p class="text-right"><%= link_to "All my games", league_season_games_path(@league.id,@season.id) %></p>
        <% else %>
          <p><em>You don't have any upcoming games</em></p>
        <% end %>
      <% else %>
        <p>No active season</p>
      <% end %>
    <% end %>
  </div>

  <div class="col-md-4">
    <h3>About</h3> 
    <%= (@league.description_html.blank? ? "<em>No description has been provided.</em>" : @league.description_html).html_safe %>
    <h3>Where we play</h3>
    <% if @league.offline? %>
      <iframe class="map" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=<%= ENV["maps_api_key"] %>&q=<%= @league.latlong %>" allowfullscreen></iframe>
    <% end %>
    <% if @league.online? %>
      <%= link_to @league.online_location, @league.online_location, target:"_blank" %>
    <% end %>
  </div>
</div>

<!-- game modal -->
<div class="modal fade" id="gameResultModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Update game result</h3>
      </div>
      <div class="modal-body">
        <iframe id="gameResultIframe" style="width:100%; height:300px; border:0;" src="/blank"></iframe>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
$('[data-action="gameResult"]').on('click',function(e){
  var t = $(this);
  e.preventDefault();
  var iframe_url = "/leagues/"+t.attr('data-league-id')+"/seasons/"+t.attr('data-season-id')+"/games/"+t.attr('data-game-id')+"/edit";
  $('#gameResultModal').modal('show');
  $('#gameResultIframe').attr("src",iframe_url);
});

var closeGameResultModal = function(){
  $('#gameResultModal').modal('hide');  
  location.reload();
};
</script>
